
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UNO ULTRA  -  LWKHO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@300;600;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --accent-blue: #0078d4;
            --accent-red: #ff5f57;
            --accent-yellow: #febc2e;
            --accent-green: #28c840;
            --glass-bg: rgba(20, 20, 25, 0.6);
            --mac-radius: 12px;
            --win-radius: 8px;
        }

        /* DISABLE SELECTION - NATIVE APP FEEL */
        * {
            user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            -webkit-tap-highlight-color: transparent;
            cursor: default;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #000;
            color: #ffffff;
            overflow: hidden;
            margin: 0;
            height: 100vh;
        }

        .webkit-scrollbar{
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            width: 8px;
            display: none;
        }

        /* WINDOWS 11 FLUID GRADIENT BACKGROUND */
        .desktop-bg {
            position: fixed;
            inset: 0;
            z-index: -1;
            background: #020617;
            overflow: hidden;
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.4;
            transition: all 3s cubic-bezier(0.4, 0, 0.2, 1);
            mix-blend-mode: plus-lighter;
        }

        /* WINDOW STYLES (MAC + WIN HYBRID) */
        .window-chrome {
            background: var(--glass-bg);
            backdrop-filter: blur(40px) saturate(150%);
            -webkit-backdrop-filter: blur(40px) saturate(150%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.5), inset 0 0 0 1px rgba(255,255,255,0.05);
            animation: windowEnter 0.7s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes windowEnter {
            from { opacity: 0; transform: scale(0.92) translateY(20px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* MAC TRAFFIC LIGHTS */
        .traffic-lights {
            display: flex;
            gap: 8px;
        }
        .light { width: 12px; height: 12px; border-radius: 50%; }
        .light-red { background: var(--accent-red); }
        .light-yellow { background: var(--accent-yellow); }
        .light-green { background: var(--accent-green); }

        /* CARD ANIMATIONS */
        .card {
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            transform-origin: bottom center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .card:hover {
            transform: translateY(-80px) scale(1.1) !important;
            z-index: 100 !important;
            filter: brightness(1.1);
        }

        .card-active {
            animation: dealCard 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        @keyframes dealCard {
            from { opacity: 0; transform: translateY(100px) rotate(15deg); }
            to { opacity: 1; transform: translateY(0) rotate(var(--rot)); }
        }

        /* DISCARD ANIMATION */
        .discard-hit {
            animation: hit 0.4s cubic-bezier(0.17, 0.89, 0.32, 1.49);
        }
        @keyframes hit {
            0% { transform: scale(1); }
            50% { transform: scale(1.15); }
            100% { transform: scale(1); }
        }

        /* HOW TO PLAY MODAL */
        .how-to-play-modal {
            position: fixed;
            inset: 0;
            z-index: 2000;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .how-to-play-modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .how-to-play-content {
            background: rgba(20, 20, 25, 0.9);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.5);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .how-to-play-modal.active .how-to-play-content {
            transform: translateY(0);
        }

        /* UTILS */
        .hide { display: none !important; }
        .macos-btn {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s;
        }
        .macos-btn:hover { background: rgba(255,255,255,0.15); }
        .macos-btn:active { transform: scale(0.97); }

        input { user-select: text !important; -webkit-user-select: text !important; outline: none; }

        /* Custom scrollbar for how-to-play content */
        .how-to-play-content::-webkit-scrollbar {
            width: 8px;
        }

        .how-to-play-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        .how-to-play-content::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        .how-to-play-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="flex items-center justify-center p-4">

    <!-- DESKTOP BACKGROUND -->
    <div class="desktop-bg" id="bg-container">
        <div id="orb-1" class="orb w-[60vw] h-[60vw] -top-1/4 -left-1/4 bg-blue-600"></div>
        <div id="orb-2" class="orb w-[50vw] h-[50vw] -bottom-1/4 -right-1/4 bg-purple-600"></div>
        <div id="orb-3" class="orb w-[40vw] h-[40vw] top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-indigo-800 opacity-20"></div>
    </div>

    <!-- BOOT UP (WIN STYLE) -->
    <div id="boot" class="fixed inset-0 z-[9999] bg-black flex flex-col items-center justify-center transition-opacity duration-1000">
        <div class="flex flex-col items-center">
        <h1>LOADING GAME, THIS MAY TAKE SEVERAL SECONDS</h1><br><br>
            <div class="flex gap-1.5">
                <div class="w-1.5 h-1.5 bg-white rounded-full animate-bounce" style="animation-delay: 0s"></div>
                <div class="w-1.5 h-1.5 bg-white rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                <div class="w-1.5 h-1.5 bg-white rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
            </div>
        </div>
    </div>

    <!-- MAIN OS INTERFACE -->
    <main id="os-root" class="hide w-full max-w-6xl h-[85vh] window-chrome flex flex-col overflow-hidden">
        <!-- TOP BAR (MAC STYLE) -->
        <header class="h-14 border-b border-white/10 flex items-center justify-between px-6 shrink-0">
            <div class="traffic-lights">
                <div class="light light-red"></div>
                <div class="light light-yellow"></div>
                <div class="light light-green"></div>
            </div>
            <div class="absolute left-1/2 -translate-x-1/2 text-[11px] font-semibold tracking-widest uppercase opacity-40">
                UNO ULTRA // REAL UNO SIMULATION
            </div>
            <div class="flex items-center gap-4">
                <button onclick="showHowToPlay()" class="text-[11px] font-medium opacity-60 hover:opacity-100 transition-opacity" style="color:white;font-size: larger;">⁉</button>
                <div id="clock" class="text-[11px] font-medium opacity-60">N/A</div>
            </div>
        </header>

        <!-- SETUP SCREEN -->
        <div id="screen-setup" class="flex-1 flex flex-col items-center justify-center p-8 overflow-y-auto">
            <div class="text-center mb-10">
                <h1 class="text-5xl font-light tracking-tight mb-2 font-[Outfit]">Setup The <b>UNO</b> Arena </h1>
                <p class="text-[10px] tracking-[0.4em] uppercase opacity-40">Setup the game by customizing the players and their names.</p>
            </div>

            <div class="w-full max-w-md space-y-3" id="player-list"></div>

            <div class="w-full max-w-md grid grid-cols-2 gap-3 mt-6">
                <button onclick="addPlayer()" class="macos-btn h-12 rounded-xl text-[10px] font-bold uppercase tracking-widest">Add Player</button>
                <button onclick="removePlayer()" class="macos-btn h-12 rounded-xl text-[10px] font-bold uppercase tracking-widest">Remove Player</button>
            </div>

            <button onclick="launchGame()" class="w-full max-w-md h-16 mt-8 bg-white text-black rounded-2xl font-bold text-lg hover:scale-[1.02] active:scale-95 transition-all">Execute The Game</button>
        </div>

        <!-- GAME SCREEN -->
        <div id="screen-game" class="hide flex-1 flex flex-col relative">
            <!-- PLAYER HUD -->
            <div id="hud" class="flex justify-center gap-3 p-6 shrink-0"></div>

            <!-- TABLE -->
            <div class="flex-1 flex flex-col items-center justify-center gap-12">
                <div class="flex items-center gap-12 md:gap-24">
                    <!-- DECK -->
                    <div onclick="drawCard()" class="group relative w-24 h-36 md:w-32 md:h-48 rounded-xl border border-white/20 bg-white/5 flex items-center justify-center hover:bg-white/10 hover:border-white/40 transition-all active:scale-95">
                        <div class="absolute inset-2 border border-white/5 rounded-lg flex items-center justify-center">
                            <span class="rotate-90 text-[10px] font-black tracking-[0.4em] opacity-20 uppercase">UNO ULTRA GAME ARENA</span>
                        </div>
                        <div id="stack-counter" class="hide absolute -top-3 -right-3 px-3 py-1 bg-blue-500 rounded-full text-xs font-bold animate-pulse shadow-lg"></div>
                    </div>

                    <!-- DISCARD -->
                    <div id="discard" class="w-28 h-40 md:w-36 md:h-52 rounded-xl flex items-center justify-center shadow-2xl transition-all duration-500 relative">
                        <div id="discard-val" class="text-6xl font-black font-[Outfit] tracking-tighter"></div>
                        <div id="discard-icon" class="absolute inset-0 flex items-center justify-center opacity-20"></div>
                    </div>
                </div>

                <!-- STATE CHIP -->
                <div class="flex items-center gap-4 px-6 py-2 bg-black/20 rounded-full border border-white/10">
                    <div id="status-color" class="w-2.5 h-2.5 rounded-full transition-all duration-1000"></div>
                    <span id="status-text" class="text-[9px] font-bold uppercase tracking-[0.3em] opacity-50">Protocol Loaded</span>
                </div>
            </div>

            <!-- HAND AREA -->
            <div class="h-64 relative flex items-end justify-center pb-10">
                <div id="hand" class="relative w-full flex justify-center items-end h-full"></div>
                
                <!-- PRIVACY MASK -->
                <div id="privacy" class="hide absolute inset-0 z-[100] backdrop-blur-3xl bg-black/40 rounded-b-lg flex flex-col items-center justify-center">
                    <p id="next-player" class="text-2xl font-light mb-6"></p>
                    <button onclick="showHand()" class="px-8 py-3 bg-white text-black rounded-xl font-bold text-[10px] tracking-widest uppercase">Decrypt Hand</button>
                </div>
            </div>
        </div>
    </main>

    <!-- HOW TO PLAY MODAL -->
    <div id="how-to-play-modal" class="how-to-play-modal" onclick="hideHowToPlay()">
        <div class="how-to-play-content" onclick="event.stopPropagation()">
            <div class="flex justify-between items-start mb-6">
                <h2 class="text-2xl font-bold font-[Outfit]">About and How to play</h2>
                <button onclick="hideHowToPlay()" class="text-white/40 hover:text-white text-2xl transition-colors">Close</button>
            </div>
            
            <div class="space-y-8">
                 <div class="bg-white/5 p-4 rounded-lg">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                <h2 class="text-2xl font-bold font-[Outfit]">About UNO ULTRA</h2>
                            </div>
                            <h4 class="font-medium">Site Sizing Issue</h4>
                            <p class="text-sm text-white/60">This game is processed to be play on large-screen devices, if not, the game
                                won't boot properly.</p> <br><hr> <br>
                                <h4 class="font-medium">Age Restriction</h4>
                                <p class="text-sm text-white/60">This game is suitable for ages <b>6</b> and above to make the player's thinking suitable for the game.</p> <br><hr><br>
                                <h4 class="font-medium">Privacy Policy</h4>
                                <p class="text-sm text-white/60">100% Guarantee No <b>DATA</b> collected, your data is <b>yours</b>
                                <br> <i><b>Copyright &copy; Jan 2026, Rights Reserved.</b></i></p>
                            </p>
                </div>
            </div><br><hr><br>
            <div class="bg-white/5 p-4 rounded-lg">
                <h2 class="text-2xl font-bold font-[Outfit]">How to play UNO ULTRA</h2>
                <br>
            <div class="space-y-8">
                <!-- The Object -->
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-blue-400">The Object</h3>
                    <p class="text-white/70">Be the first player to get rid of all the cards you have.</p>
                </div>
<hr>
                <!-- The Setup -->
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-green-400">The Setup</h3>
                    <p class="text-white/70">
                        Each player has 7 cards, the remaining cards will be placed in a draw pile
                    </p>
                </div>
<hr>
                <!-- Yell "UNO!" -->
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-yellow-400">Yell "UNO!" (Not Included In Game)</h3>
                    <p class="text-white/70">
                        The moment you have only one card left, you must yell "Uno". If someone beats you to it before the next player starts their turn, you must draw 2 penalty cards.
                    </p>
                </div>
<hr>
                <!-- Action Cards -->
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-red-400">Action Cards</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="bg-white/5 p-4 rounded-lg">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                <h4 class="font-medium">+2 Draw 2</h4>
                            </div>
                            <p class="text-sm text-white/60">Next player draws 2 cards and loses their turn.</p>
                        </div>
                        <div class="bg-white/5 p-4 rounded-lg">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                                <h4 class="font-medium">✕ Skip</h4>
                            </div>
                            <p class="text-sm text-white/60">Isolating the next player (making them lose their turn)</p>
                        </div>
                        <div class="bg-white/5 p-4 rounded-lg">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                <h4 class="font-medium">⇄ Reverse</h4>
                            </div>
                            <p class="text-sm text-white/60">Direction of play changes.</p>
                        </div>
                        <div class="bg-white/5 p-4 rounded-lg">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-3 h-3 bg-purple-500 rounded-full"></div>
                                <h4 class="font-medium">❂ Wild</h4>
                            </div>
                            <p class="text-sm text-white/60">Change the current color to anything you choose.</p>
                        </div>
                        <div class="bg-white/5 p-4 rounded-lg md:col-span-2">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-3 h-3 bg-black rounded-full border border-white/20"></div>
                                <h4 class="font-medium">(+4) Draw Four</h4>
                            </div>
                            <p class="text-sm text-white/60">
                                Can only be played if you have no cards matching the current color. 
                                `The next player can challenge this! If you had the color, you draw 4. If you didn't, the challenger draws 6.
                            </p>
                        </div>
                    </div>
                </div>
<hr>
                <!-- How to Win -->
                <div>
                    <h3 class="text-lg font-semibold mb-3 text-white">How to Win</h3>
                    <p class="text-white/70">
                        The first player to get rid of all cards wins; displaying the winning screen.
                    </p>
                </div>
                </div>
            </div>

            <div class="mt-8 pt-6 border-t border-white/10 text-center">
                <button onclick="hideHowToPlay()" class="px-6 py-2 bg-white text-black rounded-lg font-medium text-sm hover:bg-white/90 transition-colors">Got It!</button>
            </div>
        </div>
    </div>

    <!-- UI OVERLAYS -->
    <div id="wild-modal" class="hide fixed inset-0 z-[500] bg-black/80 backdrop-blur-2xl flex flex-col items-center justify-center">
        <h3 class="text-[10px] font-bold tracking-[0.8em] uppercase mb-12 opacity-40">Select Dominant Color</h3>
        <div class="grid grid-cols-2 gap-8">
            <button onclick="setWild('red')" class="w-24 h-24 rounded-3xl bg-[#ff5f57] hover:scale-110 active:scale-90 transition-all"></button>
            <button onclick="setWild('blue')" class="w-24 h-24 rounded-3xl bg-[#0078d4] hover:scale-110 active:scale-90 transition-all"></button>
            <button onclick="setWild('green')" class="w-24 h-24 rounded-3xl bg-[#28c840] hover:scale-110 active:scale-90 transition-all"></button>
            <button onclick="setWild('yellow')" class="w-24 h-24 rounded-3xl bg-[#febc2e] hover:scale-110 active:scale-90 transition-all"></button>
        </div>
    </div>

    <div id="win-screen" class="hide fixed inset-0 z-[1000] bg-white flex flex-col items-center justify-center text-black">
        <p class="text-[10px] font-black tracking-[1em] uppercase mb-4">Instance Resolved</p>
        <h1 id="winner" class="text-8xl font-black font-[Outfit] mb-12">PLAYER</h1>
        <button onclick="location.reload()" class="px-12 py-5 border-2 border-black rounded-full font-bold uppercase tracking-widest hover:bg-black hover:text-white transition-all">RELOAD GAME</button>
    </div>

    <script>
        const COLORS = {
            red: '#ff5f57',
            blue: '#0078d4',
            green: '#28c840',
            yellow: '#febc2e',
            wild: '#1a1a1a'
        };

        const STATE = {
            players: [
                { name: 'Player', isAI: false, hand: [] },
                { name: 'AI 1', isAI: true, hand: [] },
                { name: 'AI 2', isAI: true, hand: [] }
            ],
            deck: [], discard: [], turn: 0, dir: 1, stack: 0,
            activeColor: 'blue', activeVal: '', busy: false
        };

        // HOW TO PLAY MODAL FUNCTIONS
        function showHowToPlay() {
            const modal = document.getElementById('how-to-play-modal');
            modal.classList.add('active');
        }

        function hideHowToPlay() {
            const modal = document.getElementById('how-to-play-modal');
            modal.classList.remove('active');
        }

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                hideHowToPlay();
            }
        });

        // UI HELPERS
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        }
        setInterval(updateClock, 1000);
        updateClock();

        window.onload = () => {
            setTimeout(() => {
                document.getElementById('boot').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('boot').classList.add('hide');
                    document.getElementById('os-root').classList.remove('hide');
                    renderSetup();
                }, 1000);
            }, 2000);
        };

        function addPlayer() {
            if(STATE.players.length < 6
            ) {
                STATE.players.push({ 
                    name: `AI ${STATE.players.length}`, 
                    isAI: true, 
                    hand: [] 
                });
                renderSetup();
            }
        }

        function removePlayer() {
            if(STATE.players.length > 2) {
                STATE.players.pop();
                renderSetup();
            }
        }

        function renderSetup() {
            const list = document.getElementById('player-list');
            list.innerHTML = STATE.players.map((p, i) => `
                <div class="flex items-center gap-3 bg-white/5 p-3 rounded-xl border border-white/10">
                    <button onclick="toggleAI(${i})" class="w-16 h-8 rounded-lg text-[9px] font-bold uppercase ${p.isAI ? 'bg-white/10 text-white/40' : 'bg-white text-black'}">
                        ${p.isAI ? 'AI' : 'USR'}
                    </button>
                    <input type="text" value="${p.name}" onchange="STATE.players[${i}].name = this.value" 
                           class="bg-transparent flex-1 text-xs font-semibold uppercase tracking-wider">
                </div>
            `).join('');
        }

        function toggleAI(i) {
            STATE.players[i].isAI = !STATE.players[i].isAI;
            renderSetup();
        }

        function launchGame() {
            const deck = [];
            ['red', 'blue', 'green', 'yellow'].forEach(c => {
                ['0','1','2','3','4','5','6','7','8','9','Skip','Rev','+2'].forEach(v => {
                    deck.push({ c, v });
                    if(v !== '0') deck.push({ c, v });
                });
            });
            for(let i=0; i<4; i++) {
                deck.push({ c: 'wild', v: 'WILD' });
                deck.push({ c: 'wild', v: '+4' });
            }

            STATE.deck = deck.sort(() => Math.random() - 0.5);
            STATE.players.forEach(p => p.hand = STATE.deck.splice(0, 7));
            
            const start = STATE.deck.find(c => c.c !== 'wild' && !isNaN(c.v));
            STATE.discard = [start];
            STATE.activeColor = start.c;
            STATE.activeVal = start.v;

            document.getElementById('screen-setup').classList.add('hide');
            document.getElementById('screen-game').classList.remove('hide');
            
            updateBackground(STATE.activeColor);
            updateUI();
        }

        function updateBackground(color) {
            const hex = COLORS[color];
            document.getElementById('orb-1').style.background = hex;
            document.getElementById('orb-2').style.background = hex;
            document.getElementById('status-color').style.background = hex;
            document.getElementById('status-color').style.boxShadow = `0 0 15px ${hex}`;
            document.getElementById('status-text').style.color = hex;
            document.getElementById('status-text').innerText = `${color} protocol active`;
        }

        function updateUI() {
            // HUD
            const hud = document.getElementById('hud');
            hud.innerHTML = STATE.players.map((p, i) => `
                <div class="px-4 py-2 rounded-xl transition-all duration-500 flex items-center gap-3 border ${STATE.turn === i ? 'bg-white text-black border-white' : 'bg-white/5 border-white/10 opacity-40'}">
                    <div class="text-left">
                        <div class="text-[8px] font-bold uppercase opacity-50">${p.isAI ? 'CPU' : 'USR'}</div>
                        <div class="text-[10px] font-bold uppercase">${p.name}</div>
                    </div>
                    <div class="w-6 h-6 rounded-lg bg-black/10 flex items-center justify-center font-bold text-[10px]">${p.hand.length}</div>
                </div>
            `).join('');

            // Discard
            const disc = document.getElementById('discard');
            disc.style.background = COLORS[STATE.activeColor];
            disc.classList.remove('discard-hit');
            void disc.offsetWidth; // Trigger reflow
            disc.classList.add('discard-hit');
            document.getElementById('discard-val').innerText = isNaN(STATE.activeVal) ? '' : STATE.activeVal;
            document.getElementById('discard-icon').innerHTML = getSymbol(STATE.activeVal);

            // Stack
            const sc = document.getElementById('stack-counter');
            if(STATE.stack > 0) {
                sc.classList.remove('hide');
                sc.innerText = `+${STATE.stack}`;
            } else sc.classList.add('hide');

            // Turn Logic
            const p = STATE.players[STATE.turn];
            if(p.isAI) {
                document.getElementById('privacy').classList.add('hide');
                document.getElementById('hand').innerHTML = '';
                setTimeout(handleAI, 1200);
            } else {
                if(STATE.players.filter(x => !x.isAI).length > 1) {
                    document.getElementById('privacy').classList.remove('hide');
                    document.getElementById('next-player').innerText = p.name;
                    document.getElementById('hand').innerHTML = '';
                } else {
                    showHand();
                }
            }
        }

        function showHand() {
            document.getElementById('privacy').classList.add('hide');
            const hand = document.getElementById('hand');
            hand.innerHTML = '';
            const p = STATE.players[STATE.turn];

            p.hand.forEach((card, i) => {
                const playable = isValid(card);
                const el = document.createElement('div');
                const angle = (i - (p.hand.length-1)/2) * 4;
                const spread = Math.min(50, 700 / p.hand.length);
                
                el.className = `card w-28 h-40 md:w-36 md:h-52 absolute rounded-xl flex items-center justify-center ${!playable ? 'opacity-30 grayscale pointer-events-none' : 'cursor-pointer'}`;
                el.style.background = card.c === 'wild' ? '#111' : COLORS[card.c];
                el.style.left = `calc(50% + ${(i - (p.hand.length-1)/2) * spread}px)`;
                el.style.setProperty('--rot', `${angle}deg`);
                el.style.transform = `translateX(-50%) rotate(${angle}deg)`;
                el.style.zIndex = i;
                
                el.innerHTML = `
                    <div class="pointer-events-none flex flex-col items-center">
                        <div class="text-4xl font-black font-[Outfit]">${isNaN(card.v) ? '' : card.v}</div>
                        <div class="opacity-40">${getSymbol(card.v, 'w-10 h-10')}</div>
                    </div>
                `;

                if(playable && !STATE.busy) {
                    el.onclick = () => playCard(i);
                }
                hand.appendChild(el);
            });
        }

        function getSymbol(v, size = "w-16 h-16") {
            const svg = (path) => `<svg class="${size}" fill="currentColor" viewBox="0 0 24 24">${path}</svg>`;
            if(v === 'Skip') return svg('<path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41 15.59 7z"/>');
            if(v === 'Rev') return svg('<path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>');
            if(v === '+2' || v === '+4') return `<span class="text-3xl font-black">${v}</span>`;
            if(v === 'WILD') return '<div class="w-12 h-12 rounded-full border-2 border-white/20 grid grid-cols-2 overflow-hidden animate-spin"><div class="bg-red-500"></div><div class="bg-blue-500"></div><div class="bg-green-500"></div><div class="bg-yellow-400"></div></div>';
            return '';
        }

        function isValid(c) {
            if(STATE.stack > 0) return c.v === '+2' || c.v === '+4';
            return c.c === 'wild' || c.c === STATE.activeColor || c.v === STATE.activeVal;
        }

        function playCard(idx) {
            if(STATE.busy) return;
            const p = STATE.players[STATE.turn];
            const card = p.hand[idx];
            
            if(card.c === 'wild') {
                STATE.wildIdx = idx;
                document.getElementById('wild-modal').classList.remove('hide');
                return;
            }
            processMove(idx, card.c);
        }

        function setWild(color) {
            document.getElementById('wild-modal').classList.add('hide');
            processMove(STATE.wildIdx, color);
        }

        function processMove(idx, color) {
            STATE.busy = true;
            const p = STATE.players[STATE.turn];
            const card = p.hand.splice(idx, 1)[0];
            
            STATE.activeColor = color;
            STATE.activeVal = card.v;
            STATE.discard.push(card);
            
            updateBackground(color);

            if(p.hand.length === 0) {
                document.getElementById('winner').innerText = p.name;
                document.getElementById('win-screen').classList.remove('hide');
                return;
            }

            let jump = 1;
            if(card.v === '+2') STATE.stack += 2;
            if(card.v === '+4') STATE.stack += 4;
            if(card.v === 'Skip') jump = 2;
            if(card.v === 'Rev') {
                if(STATE.players.length === 2) jump = 2;
                else STATE.dir *= -1;
            }

            setTimeout(() => {
                STATE.turn = (STATE.turn + (jump * STATE.dir) + STATE.players.length) % STATE.players.length;
                STATE.busy = false;
                updateUI();
            }, 600);
        }

        function drawCard() {
            if(STATE.busy) return;
            const p = STATE.players[STATE.turn];
            const count = STATE.stack > 0 ? STATE.stack : 1;
            for(let i=0; i<count; i++) {
                if(STATE.deck.length === 0) {
                    STATE.deck = STATE.discard.splice(0, STATE.discard.length - 1).sort(() => Math.random() - 0.5);
                }
                p.hand.push(STATE.deck.pop());
            }
            STATE.stack = 0;
            STATE.turn = (STATE.turn + STATE.dir + STATE.players.length) % STATE.players.length;
            updateUI();
        }

        function handleAI() {
            const p = STATE.players[STATE.turn];
            const moves = p.hand.map((c, i) => ({...c, i})).filter(c => isValid(c));
            
            if(moves.length === 0) {
                drawCard();
            } else {
                const move = moves.find(m => m.v.includes('+')) || moves[Math.floor(Math.random()*moves.length)];
                if(move.c === 'wild') processMove(move.i, ['red','blue','green','yellow'][Math.floor(Math.random()*4)]);
                else processMove(move.i, move.c);
            }
        }
    </script>
</body>
</html>
